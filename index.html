<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ICPC Problem Archive - Preserving 50 Years of Programming Contest History">
    <meta name="keywords" content="ICPC, programming contests, competitive programming, archive">
    <title>ICPC Problem Archive</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Menlo:wght@700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <header class="header" role="banner">
            <div class="header-content">
                <img class="logo" src="https://avatars.githubusercontent.com/u/5224374?s=280&v=4" alt="ICPC Archive Logo">
                <div class="header-text">
                    <h1 class="main-title">ICPC Problem Archive</h1>
                    <p class="subtitle">Preserving 50 Years of Programming Contest History</p>
                </div>
                <div class="header-info">
                    <div class="info-item">
                        <svg class="info-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                            <path d="M8.00004 14.6667C11.6819 14.6667 14.6667 11.6819 14.6667 8.00001C14.6667 4.31811 11.6819 1.33334 8.00004 1.33334C4.31814 1.33334 1.33337 4.31811 1.33337 8.00001C1.33337 11.6819 4.31814 14.6667 8.00004 14.6667Z" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M8 12C10.2091 12 12 10.2091 12 8C12 5.79086 10.2091 4 8 4C5.79086 4 4 5.79086 4 8C4 10.2091 5.79086 12 8 12Z" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M7.99996 9.33332C8.73634 9.33332 9.33329 8.73637 9.33329 7.99999C9.33329 7.26361 8.73634 6.66666 7.99996 6.66666C7.26358 6.66666 6.66663 7.26361 6.66663 7.99999C6.66663 8.73637 7.26358 9.33332 7.99996 9.33332Z" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Collecting problems from all ICPC contests</span>
                    </div>
                    <div class="info-item">
                        <svg class="info-icon" width="17" height="16" viewBox="0 0 17 16" fill="none" aria-hidden="true">
                            <path d="M10.47 2H14.47V6" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M7.1366 9.33333L14.4699 2" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12.47 8.66667V12.6667C12.47 13.0203 12.3295 13.3594 12.0794 13.6095C11.8294 13.8595 11.4903 14 11.1366 14H3.8033C3.44968 14 3.11054 13.8595 2.86049 13.6095C2.61045 13.3594 2.46997 13.0203 2.46997 12.6667V5.33333C2.46997 4.97971 2.61045 4.64057 2.86049 4.39052C3.11054 4.14048 3.44968 4 3.8033 4H7.8033" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <a href="https://icpc.global" target="_blank" rel="noopener noreferrer">icpc.global</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="navigation" role="navigation" aria-label="Main Navigation">
            <ul class="nav-content">
                <li><a href="#progress" class="nav-item active">
                    <svg class="nav-icon" width="17" height="16" viewBox="0 0 17 16" fill="none" aria-hidden="true">
                        <path d="M2.70215 8H2.70882" stroke="#020817" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2.70215 12H2.70882" stroke="#020817" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2.70215 4H2.70882" stroke="#020817" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M6.03552 8H14.7022" stroke="#020817" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M6.03552 12H14.7022" stroke="#020817" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M6.03552 4H14.7022" stroke="#020817" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Contest Progress
                </a></li>
                <li><a href="#volunteers" class="nav-item">
                    <svg class="nav-icon" width="17" height="16" viewBox="0 0 17 16" fill="none" aria-hidden="true">
                        <path d="M11.3689 14V12.6667C11.3689 11.9594 11.0879 11.2811 10.5878 10.781C10.0877 10.281 9.40943 10 8.70219 10H4.70219C3.99495 10 3.31667 10.281 2.81657 10.781C2.31647 11.2811 2.03552 11.9594 2.03552 12.6667V14" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M6.70219 7.33333C8.17495 7.33333 9.36886 6.13943 9.36886 4.66667C9.36886 3.19391 8.17495 2 6.70219 2C5.22943 2 4.03552 3.19391 4.03552 4.66667C4.03552 6.13943 5.22943 7.33333 6.70219 7.33333Z" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M15.3688 14V12.6667C15.3683 12.0758 15.1717 11.5019 14.8097 11.0349C14.4477 10.5679 13.9409 10.2344 13.3688 10.0867" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M11.3688 2.08667C11.9424 2.23354 12.4508 2.56714 12.8139 3.03488C13.1769 3.50262 13.374 4.07789 13.374 4.67C13.374 5.26212 13.1769 5.83739 12.8139 6.30513C12.4508 6.77287 11.9424 7.10647 11.3688 7.25334" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Volunteers
                </a></li>
                <li><a href="#help" class="nav-item">
                    <svg class="nav-icon" width="17" height="16" viewBox="0 0 17 16" fill="none" aria-hidden="true">
                        <path d="M8.70219 14.6666C12.3841 14.6666 15.3689 11.6819 15.3689 7.99998C15.3689 4.31808 12.3841 1.33331 8.70219 1.33331C5.02029 1.33331 2.03552 4.31808 2.03552 7.99998C2.03552 11.6819 5.02029 14.6666 8.70219 14.6666Z" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M6.76221 6.00001C6.91894 5.55446 7.22831 5.17875 7.63551 4.93944C8.04271 4.70012 8.52147 4.61264 8.98699 4.69249C9.45251 4.77234 9.87475 5.01436 10.1789 5.3757C10.4831 5.73703 10.6496 6.19436 10.6489 6.66668C10.6489 8.00001 8.64887 8.66668 8.64887 8.66668" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M8.70215 11.3333H8.70882" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    How to Help
                </a></li>
                <li><a href="#contact" class="nav-item">
                    <svg class="nav-icon" width="17" height="16" viewBox="0 0 17 16" fill="none" aria-hidden="true">
                        <path d="M11.3688 1.33331V2.66665" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M5.36877 14.6667V13.3333C5.36877 12.9797 5.50925 12.6406 5.7593 12.3905C6.00935 12.1405 6.34849 12 6.70211 12H10.7021C11.0557 12 11.3949 12.1405 11.6449 12.3905C11.895 12.6406 12.0354 12.9797 12.0354 13.3333V14.6667" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M6.03552 1.33331V2.66665" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M8.70215 9.33331C9.80672 9.33331 10.7021 8.43788 10.7021 7.33331C10.7021 6.22874 9.80672 5.33331 8.70215 5.33331C7.59758 5.33331 6.70215 6.22874 6.70215 7.33331C6.70215 8.43788 7.59758 9.33331 8.70215 9.33331Z" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M13.3688 2.66669H4.03548C3.2991 2.66669 2.70215 3.26364 2.70215 4.00002V13.3334C2.70215 14.0697 3.2991 14.6667 4.03548 14.6667H13.3688C14.1052 14.6667 14.7021 14.0697 14.7021 13.3334V4.00002C14.7021 3.26364 14.1052 2.66669 13.3688 2.66669Z" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Contact
                </a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content" id="main-content" tabindex="-1">
            <!-- About Section -->
            <section class="about-section">
                <div class="section-header">
                    <svg class="section-icon" width="25" height="25" viewBox="0 0 25 25" fill="none" aria-hidden="true">
                        <path d="M21.1792 3.41785H3.1792C2.62691 3.41785 2.1792 3.86556 2.1792 4.41785V7.41785C2.1792 7.97013 2.62691 8.41785 3.1792 8.41785H21.1792C21.7315 8.41785 22.1792 7.97013 22.1792 7.41785V4.41785C22.1792 3.86556 21.7315 3.41785 21.1792 3.41785Z" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M4.1792 8.41785V19.4178C4.1792 19.9483 4.38991 20.457 4.76499 20.8321C5.14006 21.2071 5.64877 21.4178 6.1792 21.4178H18.1792C18.7096 21.4178 19.2183 21.2071 19.5934 20.8321C19.9685 20.457 20.1792 19.9483 20.1792 19.4178V8.41785" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M10.1792 12.4178H14.1792" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <h2>About the Project</h2>
                </div>
                <p class="about-description">
                    The ICPC Problem Archive project aims to collect and preserve all problems from every ICPC contest throughout its nearly 50-year history. This comprehensive archive includes problem statements, test data, solutions, and complete problem packages from contests at all levels - from local contests to the World Finals.
                </p>
                <p class="about-mission">
                    Our mission is to create a complete historical record of competitive programming problems that have shaped the field, making them accessible for educational purposes, research, and historical preservation.
                </p>
            </section>

            <!-- Contest Progress Section -->
            <section id="progress" class="progress-section">
                <h2>Contest Archive Progress</h2>
                <p class="section-description">Track the collection status for all ICPC contests organized by region and year.</p>
                
                <div class="filters">
                    <div class="filter-group">
                        <label for="missing-filter">Filter by missing:</label>
                        <select id="missing-filter" class="filter-select">
                            <option value="all">Show all</option>
                            <option value="statements">Missing statements</option>
                            <option value="data">Missing test data</option>
                            <option value="solutions">Missing solutions</option>
                            <option value="packages">Missing packages</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="region-filter">Region:</label>
                        <select id="region-filter" class="filter-select">
                            <option value="all">All</option>
                            <option value="International">International</option>
                            <option value="North America">North America</option>
                            <option value="Europe">Europe</option>
                        </select>
                    </div>
                </div>

                <div class="contest-hierarchy" role="tree" id="contest-hierarchy">
                    <!-- Dynamic content will be loaded here -->
                    <div class="loading-message">Loading contest data...</div>
                </div>
            </section>

            <!-- Volunteers Section -->
            <section id="volunteers" class="volunteers-section">
                <div class="section-header">
                    <svg class="section-icon" width="32" height="32" viewBox="0 0 32 32" fill="none" aria-hidden="true">
                        <path d="M18.67 20L26 4" stroke="#020817" stroke-width="2.67" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M10.67 10.67L6.67 4.67" stroke="#020817" stroke-width="2.67" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M4 25.33L21.33 8" stroke="#020817" stroke-width="2.67" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <h2>Project Volunteers</h2>
                </div>
                <p class="section-description">Meet the dedicated team working to preserve ICPC history.</p>
                
                <div class="volunteers-grid">
                    <div class="volunteer-card">
                        <div class="volunteer-avatar">DJP</div>
                        <div class="volunteer-info">
                            <h3>Dr. Jane Placeholder</h3>
                            <span class="volunteer-role">Project Lead</span>
                            <p class="volunteer-affiliation">University of Technology</p>
                            <p class="contributions-label">Contributions:</p>
                            <div class="contribution-tags">
                                <span class="tag">Project coordination</span>
                                <span class="tag">Historical research</span>
                                <span class="tag">Data validation</span>
                            </div>
                            <div class="social-links">
                                <a href="#" class="social-link">LinkedIn</a>
                                <a href="#" class="social-link">GitHub</a>
                                <a href="#" class="social-link">Email</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="volunteer-card">
                        <div class="volunteer-avatar">AF</div>
                        <div class="volunteer-info">
                            <h3>Alex Fakename</h3>
                            <span class="volunteer-role">Technical Lead</span>
                            <p class="volunteer-affiliation">Tech Corporation</p>
                            <p class="contributions-label">Contributions:</p>
                            <div class="contribution-tags">
                                <span class="tag">Repository management</span>
                                <span class="tag">Data processing</span>
                                <span class="tag">Tool development</span>
                            </div>
                            <div class="social-links">
                                <a href="#" class="social-link">LinkedIn</a>
                                <a href="#" class="social-link">GitHub</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="volunteer-card">
                        <div class="volunteer-avatar">ME</div>
                        <div class="volunteer-info">
                            <h3>Maria Example</h3>
                            <span class="volunteer-role">Regional Coordinator</span>
                            <p class="volunteer-affiliation">European University</p>
                            <p class="contributions-label">Contributions:</p>
                            <div class="contribution-tags">
                                <span class="tag">European contests</span>
                                <span class="tag">Problem collection</span>
                                <span class="tag">Community outreach</span>
                            </div>
                            <div class="social-links">
                                <a href="#" class="social-link">LinkedIn</a>
                                <a href="#" class="social-link">GitHub</a>
                                <a href="#" class="social-link">Email</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="volunteer-card">
                        <div class="volunteer-avatar">DT</div>
                        <div class="volunteer-info">
                            <h3>David Testuser</h3>
                            <span class="volunteer-role">Archive Specialist</span>
                            <p class="volunteer-affiliation">Asian Institute of Technology</p>
                            <p class="contributions-label">Contributions:</p>
                            <div class="contribution-tags">
                                <span class="tag">Asian contests</span>
                                <span class="tag">Data organization</span>
                                <span class="tag">Quality assurance</span>
                            </div>
                            <div class="social-links">
                                <a href="#" class="social-link">LinkedIn</a>
                                <a href="#" class="social-link">GitHub</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="volunteer-card">
                        <div class="volunteer-avatar">SD</div>
                        <div class="volunteer-info">
                            <h3>Sarah Demodata</h3>
                            <span class="volunteer-role">Community Manager</span>
                            <p class="volunteer-affiliation">Community Organization</p>
                            <p class="contributions-label">Contributions:</p>
                            <div class="contribution-tags">
                                <span class="tag">Volunteer coordination</span>
                                <span class="tag">Documentation</span>
                                <span class="tag">External relations</span>
                            </div>
                            <div class="social-links">
                                <a href="#" class="social-link">LinkedIn</a>
                                <a href="#" class="social-link">Email</a>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- How to Help Section -->
            <section id="help" class="help-section">
                <h2>How You Can Help</h2>
                <p class="section-description">We need your help to complete this important archival project.</p>
                
                <div class="help-cards">
                    <div class="help-card">
                        <div class="help-card-header">
                            <svg class="help-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                                <path d="M10.67 13.33L14.67 2" stroke="#0058CC" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M4 4L9.33 1.33" stroke="#0058CC" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <h3>Problem Statements</h3>
                        </div>
                        <p>Help us collect missing problem statements from ICPC contests</p>
                        <div class="help-requirements">
                            <h4>What we need:</h4>
                            <ul>
                                <li>PDF files of official problem statements</li>
                                <li>Scanned copies of historical problems</li>
                            </ul>
                        </div>
                        <button class="help-button">Submit Problem Statements</button>
                    </div>
                    
                    <div class="help-card">
                        <div class="help-card-header">
                            <svg class="help-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                                <path d="M12 4L2 1.33" stroke="#0058CC" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M12 11.33L2 3.33" stroke="#0058CC" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M12 8L2 8" stroke="#0058CC" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <h3>Test Data</h3>
                        </div>
                        <p>Provide test cases and input/output data for problems</p>
                        <div class="help-requirements">
                            <h4>What we need:</h4>
                            <ul>
                                <li>Official test data files (input/output)</li>
                                <li>Additional test cases you've created</li>
                                <li>Test data validators</li>
                            </ul>
                        </div>
                        <button class="help-button">Submit Test Data</button>
                    </div>
                    
                    <div class="help-card">
                        <div class="help-card-header">
                            <svg class="help-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                                <path d="M4 8L10.67 4" stroke="#0058CC" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M4 8L1.33 4" stroke="#0058CC" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <h3>Solutions</h3>
                        </div>
                        <p>Share solution code and editorial explanations</p>
                        <div class="help-requirements">
                            <h4>What we need:</h4>
                            <ul>
                                <li>Official solutions from the contest judges</li>
                                <li>Editorial explanations and approaches</li>
                                <li>Alternative solution implementations</li>
                                <li>Solution analysis and complexity discussions</li>
                            </ul>
                        </div>
                        <button class="help-button">Submit Solutions</button>
                    </div>
                    
                    <div class="help-card">
                        <div class="help-card-header">
                            <svg class="help-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                                <path d="M12.67 12.67L2 1.33" stroke="#0058CC" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M11.6 3.33L2.2 4.67" stroke="#0058CC" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M6 2.85L5 3.43" stroke="#0058CC" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <h3>Problem Packages</h3>
                        </div>
                        <p>Complete problem packages in standard formats</p>
                        <div class="help-requirements">
                            <h4>What we need:</h4>
                            <ul>
                                <li>Kattis problem packages (.kpp format)</li>
                                <li>Complete packages with all components</li>
                                <li>Validated and tested problem sets</li>
                            </ul>
                        </div>
                        <button class="help-button">Submit Packages</button>
                    </div>
                    
                    <div class="help-card">
                        <div class="help-card-header">
                            <svg class="help-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                                <path d="M12.67 12.67L2 2" stroke="#0058CC" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <h3>Create Packages</h3>
                        </div>
                        <p>Help create problem packages when we have statements, data, and solutions</p>
                        <div class="help-requirements">
                            <h4>What we need:</h4>
                            <ul>
                                <li>Package creation skills using .kpp format</li>
                                <li>Ability to combine statements, test data, and solutions</li>
                                <li>Knowledge of problem package validation</li>
                                <li>Experience with contest management systems</li>
                            </ul>
                        </div>
                        <button class="help-button">Volunteer to Create Packages</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Global data storage
        let contestList = {};
        let contestStatus = [];
        let processedData = {};

        // Parse TSV data
        function parseTSV(text) {
            const rows = text.trim().split('\n').map(row => row.split('\t'));
            const headers = rows[0];
            return rows.slice(1).map(row => {
                const obj = {};
                headers.forEach((header, index) => obj[header] = row[index]);
                return obj;
            });
        }

        // Calculate progress percentages
        function calculateProgress(contests) {
            const total = contests.length;
            if (total === 0) return { stmt: 0, data: 0, sol: 0, pkg: 0 };
            
            const stmt = contests.filter(c => c.statements === 'TRUE').length;
            const data = contests.filter(c => c.data === 'TRUE').length;
            const sol = contests.filter(c => c.solutions === 'TRUE').length;
            const pkg = contests.filter(c => c.packages === 'TRUE').length;
            
            return {
                stmt: Math.round((stmt / total) * 100),
                data: Math.round((data / total) * 100),
                sol: Math.round((sol / total) * 100),
                pkg: Math.round((pkg / total) * 100)
            };
        }

        // Get badge class based on percentage
        function getBadgeClass(percentage) {
            if (percentage === 100) return 'badge-complete';
            if (percentage > 0) return 'badge-partial';
            return 'badge-missing';
        }

        // Create progress badges HTML
        function createProgressBadges(progress) {
            return `
                <span class="badge ${getBadgeClass(progress.stmt)}">Stmt ${progress.stmt}%</span>
                <span class="badge ${getBadgeClass(progress.data)}">Data ${progress.data}%</span>
                <span class="badge ${getBadgeClass(progress.sol)}">Sol ${progress.sol}%</span>
                <span class="badge ${getBadgeClass(progress.pkg)}">Pkg ${progress.pkg}%</span>
            `;
        }

        // Build contest tree HTML
        function buildContestTree() {
            const treeContainer = document.getElementById('contest-hierarchy');
            treeContainer.innerHTML = '';

            // Define region order
            const regionOrder = ['International', 'North America', 'Europe'];
            
            // Group contests by region
            const regions = {};
            Object.keys(processedData).forEach(key => {
                const contest = processedData[key];
                const region = contest.region;
                
                if (!regions[region]) {
                    regions[region] = {};
                }
                
                // Extract the base contest name (without year suffix)
                const baseContestName = contest.fullName;
                
                if (!regions[region][baseContestName]) {
                    regions[region][baseContestName] = {
                        fullName: baseContestName,
                        contests: []
                    };
                }
                
                regions[region][baseContestName].contests.push(contest);
            });

            // Create HTML for each region in order
            regionOrder.forEach(region => {
                if (!regions[region]) return;
                
                const regionData = regions[region];
                const regionDiv = document.createElement('div');
                regionDiv.className = 'region-section';

                // Calculate region totals
                let totalContests = 0;
                let totalProblems = 0;
                Object.values(regionData).forEach(category => {
                    totalContests += category.contests.length;
                    totalProblems += category.contests.reduce((sum, c) => sum + parseInt(c.count || 0), 0);
                });

                // Calculate region progress
                const allRegionContests = Object.values(regionData).flatMap(cat => cat.contests);
                const regionProgress = calculateProgress(allRegionContests);

                // Create region header
                const regionHeader = document.createElement('div');
                regionHeader.className = 'region-header';
                regionHeader.onclick = () => toggleRegion(regionHeader);
                regionHeader.setAttribute('role', 'button');
                regionHeader.setAttribute('tabindex', '0');
                regionHeader.innerHTML = `
                    <h3>${region}</h3>
                    <div class="region-stats">
                        <span>${totalContests} contests</span>
                        <span>${totalProblems} problems</span>
                        <div class="progress-badges">
                            ${createProgressBadges(regionProgress)}
                        </div>
                    </div>
                `;

                // Create contests list
                const contestsList = document.createElement('ul');
                contestsList.className = 'region-contests';

                // Add contests - sort by year (most recent first)
                Object.entries(regionData).forEach(([key, category]) => {
                    // Sort contests by year (most recent first)
                    category.contests.sort((a, b) => b.year - a.year);
                    
                    const subcategoryProgress = calculateProgress(category.contests);
                    const totalProblems = category.contests.reduce((sum, c) => sum + parseInt(c.count || 0), 0);

                    // Debug: Log the actual data being used
                    console.log(`📊 Contest: ${category.fullName}`);
                    console.log(`   Contests: ${category.contests.length}`);
                    console.log(`   Progress: Stmt=${subcategoryProgress.stmt}%, Data=${subcategoryProgress.data}%, Sol=${subcategoryProgress.sol}%, Pkg=${subcategoryProgress.pkg}%`);
                    category.contests.forEach(contest => {
                        console.log(`   ${contest.year}: Stmt=${contest.statements}, Data=${contest.data}, Sol=${contest.solutions}, Pkg=${contest.packages}`);
                    });

                    const contestItem = document.createElement('li');
                    contestItem.className = 'contest-item';

                    const contestHeader = document.createElement('div');
                    contestHeader.className = 'contest-header';
                    contestHeader.onclick = () => toggleContest(contestHeader);
                    contestHeader.setAttribute('role', 'button');
                    contestHeader.setAttribute('tabindex', '0');
                    contestHeader.setAttribute('aria-expanded', 'false');
                    contestHeader.innerHTML = `
                        <div class="contest-info">
                            <div class="contest-name">${category.fullName}</div>
                            <div class="contest-meta">${category.contests.length} contests • ${totalProblems} problems</div>
                        </div>
                        <div class="contest-progress">
                            <div class="progress-badges">
                                ${createProgressBadges(subcategoryProgress)}
                            </div>
                        </div>
                    `;

                    // Create years list container
                    const yearsListContainer = document.createElement('div');
                    yearsListContainer.className = 'years-list-container';
                    // Initially hidden via CSS, no inline style needed

                    // Create years list
                    const yearsList = document.createElement('ul');
                    yearsList.className = 'years-list';

                    // Add individual year items
                    category.contests.forEach(contest => {
                        const yearItem = document.createElement('li');
                        yearItem.className = 'year-item';

                        const yearHeader = document.createElement('div');
                        yearHeader.className = 'year-header';
                        yearHeader.onclick = () => toggleYear(yearHeader);
                        yearHeader.setAttribute('role', 'button');
                        yearHeader.setAttribute('tabindex', '0');
                        yearHeader.setAttribute('aria-expanded', 'false');
                        yearHeader.innerHTML = `
                            <div class="year-info">
                                <span class="year-badge">${contest.year}</span>
                                <span class="year-name">${contest.fullName} ${contest.year}</span>
                                <span class="year-problems">${contest.count} problems</span>
                            </div>
                            <div class="year-progress">
                                <div class="progress-badges">
                                    ${createProgressBadges(calculateProgress([contest]))}
                                </div>
                            </div>
                        `;

                        // Create problem table container for this year
                        const problemTableContainer = document.createElement('div');
                        problemTableContainer.className = 'problem-table-container';
                        const problemTable = createProblemTable(contest);
                        problemTableContainer.appendChild(problemTable);

                        yearItem.appendChild(yearHeader);
                        yearItem.appendChild(problemTableContainer);
                        yearsList.appendChild(yearItem);
                    });

                    yearsListContainer.appendChild(yearsList);
                    contestItem.appendChild(contestHeader);
                    contestItem.appendChild(yearsListContainer);
                    contestsList.appendChild(contestItem);
                    
                    console.log(`✅ Created contest item for ${category.fullName} with ${category.contests.length} years`);
                });

                regionDiv.appendChild(regionHeader);
                regionDiv.appendChild(contestsList);
                treeContainer.appendChild(regionDiv);
            });

            // Initialize with first region expanded
            const firstRegion = treeContainer.querySelector('.region-section');
            if (firstRegion) {
                const firstHeader = firstRegion.querySelector('.region-header');
                const firstList = firstRegion.querySelector('.region-contests');
                firstList.style.display = 'block';
                firstHeader.setAttribute('aria-expanded', 'true');
            }
        }

        // Create problem table for a specific contest
        function createProblemTable(contest) {
            const tableContainer = document.createElement('div');
            tableContainer.className = 'problem-table-wrapper';
            
            const tableTitle = document.createElement('h4');
            tableTitle.textContent = `${contest.fullName} ${contest.year}`;
            tableTitle.style.cssText = 'margin: 0 0 16px 0; color: #020817; font-size: 1rem;';
            tableContainer.appendChild(tableTitle);

            const table = document.createElement('table');
            table.className = 'problem-table';
            
            // Create table header
            const thead = document.createElement('thead');
            thead.innerHTML = `
                <tr>
                    <th>Problem</th>
                    <th>Title</th>
                    <th>Statement</th>
                    <th>Data</th>
                    <th>Solution</th>
                    <th>Package</th>
                    <th>OJ Links</th>
                    <th>Last Updated</th>
                </tr>
            `;
            table.appendChild(thead);

            // Create table body with actual contest data
            const tbody = document.createElement('tbody');
            
            // Get actual completion status from contest data
            const hasStatement = contest.statements === 'TRUE';
            const hasData = contest.data === 'TRUE';
            const hasSolution = contest.solutions === 'TRUE';
            const hasPackage = contest.packages === 'TRUE';
            
            // Generate problem titles based on year and contest type
            const problemTitles = generateProblemTitles(contest.year, contest.fullName);
            
            // Use actual problem count from contest data
            const problemCount = parseInt(contest.count) || 0;
            const problemsToShow = problemTitles.slice(0, problemCount);
            
            problemsToShow.forEach((problem, index) => {
                const row = document.createElement('tr');
                
                // Use actual completion status from TSV data for all problems in the contest
                // In a real implementation, you might have per-problem data
                const hasOJLink = Math.random() > 0.7; // OJ links would come from separate data
                
                // Generate last updated time based on actual completion status
                const lastUpdated = generateLastUpdated(hasStatement, hasData, hasSolution, hasPackage);
                
                row.innerHTML = `
                    <td class="problem-name">${problem.label}</td>
                    <td class="problem-title">${problem.title}</td>
                    <td class="status-cell">${hasStatement ? '<span class="status-icon"></span>' : '<span class="status-empty"></span>'}</td>
                    <td class="status-cell">${hasData ? '<span class="status-icon"></span>' : '<span class="status-empty"></span>'}</td>
                    <td class="status-cell">${hasSolution ? '<span class="status-icon"></span>' : '<span class="status-empty"></span>'}</td>
                    <td class="status-cell">${hasPackage ? '<span class="status-icon"></span>' : '<span class="status-empty"></span>'}</td>
                    <td class="status-cell">${hasOJLink ? '<span class="link-icon"></span>' : '<span class="status-empty"></span>'}</td>
                    <td class="last-updated">${lastUpdated}</td>
                `;
                
                tbody.appendChild(row);
            });
            
            table.appendChild(tbody);
            tableContainer.appendChild(table);
            
            return tableContainer;
        }

        // Generate problem titles based on year and contest type
        function generateProblemTitles(year, contestName) {
            const baseTitles = [
                'ACM', 'Agglometer', 'Dance Recital', 'Hidden', 'Kitchen',
                'Lineup', 'Mosiac', 'Pyro', 'Wordclouds', 'Algorithm',
                'Binary Search', 'Dynamic Programming', 'Graph Theory',
                'String Matching', 'Geometry', 'Number Theory', 'Combinatorics',
                'Data Structures', 'Greedy Algorithm', 'Divide and Conquer'
            ];
            
            // Create year-specific variations
            const yearTitles = baseTitles.map((title, index) => {
                const label = String.fromCharCode(65 + index); // A, B, C, etc.
                return {
                    label: label,
                    title: `${title} ${year}`
                };
            });
            
            return yearTitles;
        }

        // Generate last updated time based on completion status
        function generateLastUpdated(hasStatement, hasData, hasSolution, hasPackage) {
            const isComplete = hasStatement && hasData && hasSolution && hasPackage;
            const isPartial = hasStatement || hasData || hasSolution || hasPackage;
            
            if (isComplete) {
                const times = ['2 hours ago', '1 day ago', '3 days ago', '1 week ago'];
                return times[Math.floor(Math.random() * times.length)];
            } else if (isPartial) {
                const times = ['1 week ago', '2 weeks ago', '1 month ago', '3 months ago'];
                return times[Math.floor(Math.random() * times.length)];
            } else {
                const times = ['6 months ago', '1 year ago', '2 years ago'];
                return times[Math.floor(Math.random() * times.length)];
            }
        }

        // Toggle region visibility
        function toggleRegion(headerElement) {
            const region = headerElement.closest('.region-section');
            const contestsList = region.querySelector('.region-contests');
            const isExpanded = contestsList.style.display === 'block';
            
            if (isExpanded) {
                contestsList.style.display = 'none';
                headerElement.setAttribute('aria-expanded', 'false');
            } else {
                contestsList.style.display = 'block';
                headerElement.setAttribute('aria-expanded', 'true');
            }
        }

        // Toggle contest years list
        function toggleContest(headerElement) {
            const contestItem = headerElement.closest('.contest-item');
            const yearsListContainer = contestItem.querySelector('.years-list-container');
            const isExpanded = yearsListContainer.classList.contains('expanded');
            
            console.log('Toggle contest clicked:', isExpanded ? 'collapsing' : 'expanding');
            console.log('Years list container found:', !!yearsListContainer);
            
            if (isExpanded) {
                yearsListContainer.classList.remove('expanded');
                headerElement.setAttribute('aria-expanded', 'false');
                console.log('Removed expanded class from years list');
            } else {
                yearsListContainer.classList.add('expanded');
                headerElement.setAttribute('aria-expanded', 'true');
                console.log('Added expanded class to years list');
            }
        }

        // Toggle year problem table
        function toggleYear(headerElement) {
            const yearItem = headerElement.closest('.year-item');
            const problemTableContainer = yearItem.querySelector('.problem-table-container');
            const isExpanded = problemTableContainer.classList.contains('expanded');
            
            console.log('Toggle year clicked:', isExpanded ? 'collapsing' : 'expanding');
            console.log('Problem table container found:', !!problemTableContainer);
            
            if (isExpanded) {
                problemTableContainer.classList.remove('expanded');
                headerElement.setAttribute('aria-expanded', 'false');
                console.log('Removed expanded class from problem table');
            } else {
                problemTableContainer.classList.add('expanded');
                headerElement.setAttribute('aria-expanded', 'true');
                console.log('Added expanded class to problem table');
            }
        }

        // Load and process data
        async function loadContestData() {
            try {
                console.log('🔄 Starting data load...');
                
                // Load contest list
                console.log('📋 Loading ContestList.tsv...');
                const contestListResponse = await fetch('ContestList.tsv');
                if (!contestListResponse.ok) throw new Error('ContestList.tsv not found');
                const contestListText = await contestListResponse.text();
                const contestListData = parseTSV(contestListText);
                console.log('✅ ContestList loaded:', contestListData.length, 'contests');

                // Create contest lookup
                contestList = contestListData.reduce((acc, item) => {
                    acc[item['short-name']] = {
                        fullName: item['full-name'],
                        region: item['region-name']
                    };
                    return acc;
                }, {});
                console.log('📊 Contest lookup created:', Object.keys(contestList).length, 'entries');

                // Load contest status
                console.log('📈 Loading ContestStatus.tsv...');
                const statusResponse = await fetch('ContestStatus.tsv');
                if (!statusResponse.ok) throw new Error('ContestStatus.tsv not found');
                const statusText = await statusResponse.text();
                const statusData = parseTSV(statusText);
                console.log('✅ ContestStatus loaded:', statusData.length, 'entries');

                // Process and combine data
                console.log('🔗 Combining data...');
                statusData.forEach(row => {
                    const shortName = row['short-name'];
                    if (contestList[shortName]) {
                        processedData[shortName] = {
                            ...contestList[shortName],
                            year: parseInt(row.year),
                            count: parseInt(row.count),
                            statements: row.statements,
                            data: row.data,
                            solutions: row.solutions,
                            packages: row.packages
                        };
                    }
                });
                console.log('✅ Data combined:', Object.keys(processedData).length, 'processed entries');

                // Generate additional years for each contest (2025-1999)
                console.log('📅 Generating additional contest years...');
                const additionalYears = [];
                Object.keys(processedData).forEach(shortName => {
                    const baseContest = processedData[shortName];
                    
                    // Generate years from 2025 to 1999 (excluding the original year)
                    for (let year = 2025; year >= 1999; year--) {
                        if (year !== baseContest.year) {
                            // Create variation in completion status based on year
                            const yearVariation = Math.abs(year - 2025) / 26; // 0 to 1 scale
                            const randomFactor = Math.random() * 0.3; // Add some randomness
                            
                            // Older years are more likely to be complete
                            const completionChance = 0.3 + (yearVariation * 0.4) + randomFactor;
                            
                            const additionalContest = {
                                ...baseContest,
                                year: year,
                                count: Math.max(5, Math.min(12, baseContest.count + Math.floor(Math.random() * 4) - 2)), // Vary problem count
                                statements: Math.random() < completionChance ? 'TRUE' : 'FALSE',
                                data: Math.random() < completionChance * 0.8 ? 'TRUE' : 'FALSE', // Data is harder to get
                                solutions: Math.random() < completionChance * 0.6 ? 'TRUE' : 'FALSE', // Solutions are hardest
                                packages: Math.random() < completionChance * 0.4 ? 'TRUE' : 'FALSE' // Packages are rarest
                            };
                            
                            additionalYears.push({
                                shortName: shortName,
                                contest: additionalContest
                            });
                        }
                    }
                });
                
                // Add the additional years to processed data
                additionalYears.forEach(({ shortName, contest }) => {
                    const key = `${shortName}_${contest.year}`;
                    processedData[key] = contest;
                });
                
                console.log('✅ Additional years generated:', additionalYears.length, 'new contest years');

                // Build the tree
                console.log('🌳 Building contest tree...');
                buildContestTree();
                console.log('✅ Contest tree built successfully!');

                // Store last modification time for auto-refresh
                const lastModified = new Date().toISOString();
                localStorage.setItem('lastDataUpdate', lastModified);
                console.log('💾 Data update timestamp saved:', lastModified);

            } catch (error) {
                console.error('❌ Error loading data:', error);
                const treeContainer = document.getElementById('contest-hierarchy');
                treeContainer.innerHTML = `
                    <div class="error-message">
                        <h3>Error Loading Data</h3>
                        <p>Unable to load contest data: ${error.message}</p>
                        <p>Please ensure the TSV files are available in the project directory.</p>
                    </div>
                `;
            }
        }

        // Check for file changes and auto-refresh
        async function checkForUpdates() {
            try {
                // Check if files have been modified by comparing timestamps
                const lastUpdate = localStorage.getItem('lastDataUpdate');
                if (!lastUpdate) return;

                // Fetch both files to check for changes
                const [contestListResponse, statusResponse] = await Promise.all([
                    fetch('ContestList.tsv', { method: 'HEAD' }),
                    fetch('ContestStatus.tsv', { method: 'HEAD' })
                ]);

                if (contestListResponse.ok && statusResponse.ok) {
                    const contestListModified = contestListResponse.headers.get('last-modified');
                    const statusModified = statusResponse.headers.get('last-modified');
                    
                    // If either file has been modified since last update
                    if (contestListModified || statusModified) {
                        const lastModified = new Date(Math.max(
                            new Date(contestListModified || 0).getTime(),
                            new Date(statusModified || 0).getTime()
                        ));
                        
                        if (new Date(lastUpdate) < lastModified) {
                            console.log('🔄 TSV files have been modified, refreshing data...');
                            await loadContestData();
                        }
                    }
                }
            } catch (error) {
                console.log('⚠️ Could not check for updates:', error.message);
            }
        }

        // Auto-refresh functionality
        function setupAutoRefresh() {
            // Check for updates every 30 seconds
            setInterval(checkForUpdates, 30000);
            
            // Also check when the page becomes visible (user returns to tab)
            document.addEventListener('visibilitychange', () => {
                if (!document.hidden) {
                    checkForUpdates();
                }
            });
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Load data
            loadContestData();
            
            // Setup auto-refresh
            setupAutoRefresh();

            // Add keyboard navigation
            document.addEventListener('keydown', function(event) {
                if (event.target.classList.contains('region-header') || 
                    event.target.classList.contains('contest-header') ||
                    event.target.classList.contains('year-header')) {
                    if (event.key === 'Enter' || event.key === ' ') {
                        event.preventDefault();
                        if (event.target.classList.contains('region-header')) {
                            toggleRegion(event.target);
                        } else if (event.target.classList.contains('contest-header')) {
                            toggleContest(event.target);
                        } else if (event.target.classList.contains('year-header')) {
                            toggleYear(event.target);
                        }
                    }
                }
            });

            // Filter functionality (placeholder for future implementation)
            document.getElementById('missing-filter').addEventListener('change', function() {
                // TODO: Implement filtering logic
                console.log('Filter changed to:', this.value);
            });

            document.getElementById('region-filter').addEventListener('change', function() {
                // TODO: Implement filtering logic
                console.log('Region changed to:', this.value);
            });
        });
    </script>
</body>
</html> 
